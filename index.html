<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تقويم بابل</title>

  <style>
    body{
      font-family: Arial;
      background:#f4f6f9;
      text-align:center;
      margin:0;
    }
    h1{ color:#2e7d32; margin-top:30px; }
    .container{
      max-width:800px;
      margin:20px auto;
      background:white;
      padding:20px;
      border-radius:15px;
      box-shadow:0 5px 15px rgba(0,0,0,0.1);
    }
    input, select{
      padding:10px;
      margin:6px;
      width:110px;
      text-align:center;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:16px;
    }
    select{ width:260px; }
    button{
      background:#2e7d32;
      color:white;
      border:none;
      padding:10px 22px;
      border-radius:10px;
      cursor:pointer;
      margin-top:10px;
      font-size:16px;
    }
    #output{
      margin-top:20px;
      background:#e3f2fd;
      padding:15px;
      border-radius:10px;
      font-size:18px;
      font-weight:700;
    }
    .small{
      font-size:14px;
      color:#444;
      margin-top:10px;
    }
  </style>
</head>

<body>
  <h1>تقويم بابل</h1>

  <div class="container">
    <h2>اختر التاريخ</h2>

    <div>
      <input type="number" id="day" placeholder="اليوم" />
      <input type="number" id="month" placeholder="الشهر" />
      <input type="number" id="year" placeholder="السنة" />
    </div>

    <div>
      <select id="mode">
        <option value="g2b">ميلادي → بابلي (شمسي)</option>
        <option value="b2g">بابلي (شمسي) → ميلادي</option>

        <option value="g2h">ميلادي → هجري قمري</option>
        <option value="h2g">هجري قمري → ميلادي</option>

        <option value="b2h">بابلي (شمسي) → هجري قمري</option>
        <option value="h2b">هجري قمري → بابلي (شمسي)</option>
      </select>
    </div>

    <div class="small">
      تصحيح الهجري (اختياري): 
      <input type="number" id="hijriOffset" value="0" style="width:80px" />
      يوم
    </div>

    <button onclick="convert()">تحويل</button>

    <div id="output">أدخل التاريخ ثم اضغط تحويل</div>
  </div>

  <!-- Libraries (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-jalaali@0.10.4/build/moment-jalaali.js"></script>

  <script>
    // أشهر "بابلي شمسي" (نفس الجلالي لكن بأسماء تبدأ برمضان)
    const babylonMonths = [
      "رمضان","شوال","ذو القعدة","ذو الحجة","محرم","صفر",
      "ربيع الأول","ربيع الثاني","جمادى الأولى","جمادى الآخرة","رجب","شعبان"
    ];

    function pad2(n){ return String(n).padStart(2,"0"); }

    function formatBabylonFromMoment(mJalali){
      const d = mJalali.jDate();
      const mo = mJalali.jMonth() + 1; // 1..12
      const y = mJalali.jYear();
      const name = babylonMonths[mo-1];
      return `${y} / ${name} / ${d} (شهر رقم ${mo})`;
    }

    function readInputs(){
      const d = parseInt(document.getElementById("day").value, 10);
      const m = parseInt(document.getElementById("month").value, 10);
      const y = parseInt(document.getElementById("year").value, 10);
      return {d,m,y};
    }

    function convert(){
      const out = document.getElementById("output");
      const {d,m,y} = readInputs();
      const mode = document.getElementById("mode").value;
      const hijriOffset = parseInt(document.getElementById("hijriOffset").value || "0", 10);

      if(!d || !m || !y){
        out.innerHTML = "الرجاء إدخال اليوم والشهر والسنة";
        return;
      }

      let base; // moment object

      // 1) Create base moment from input (حسب نوع الإدخال)
      if(mode === "g2b" || mode === "g2h"){
        // input Gregorian
        base = moment(`${y}-${pad2(m)}-${pad2(d)}`, "YYYY-MM-DD", true);
      } else if(mode === "b2g" || mode === "b2h"){
        // input Babylon = Jalali numbers (نفس الجلالي رقمياً)
        // month هنا رقم 1..12
        base = moment(`${y}/${m}/${d}`, "jYYYY/jM/jD", true);
      } else if(mode === "h2g" || mode === "h2b"){
        // input Hijri
        base = moment(`${y}/${m}/${d}`, "iYYYY/iM/iD", true).add(hijriOffset, "days");
      } else {
        out.innerHTML = "وضع التحويل غير معروف";
        return;
      }

      if(!base.isValid()){
        out.innerHTML = "تاريخ غير صحيح. تأكد من الأرقام (اليوم/الشهر/السنة).";
        return;
      }

      // 2) Output conversion
      if(mode === "g2b"){
        const mJ = base.clone(); // same moment
        out.innerHTML = `النتيجة (بابلي شمسي): ${formatBabylonFromMoment(mJ)}`;
        return;
      }

      if(mode === "b2g"){
        out.innerHTML = `النتيجة (ميلادي): ${base.format("YYYY-MM-DD")}`;
        return;
      }

      if(mode === "g2h"){
        const h = base.clone().add(-hijriOffset, "days"); // حتى يبقى نفس التصحيح بالعكس
        out.innerHTML = `النتيجة (هجري قمري): ${h.format("iYYYY/iM/iD")}`;
        return;
      }

      if(mode === "h2g"){
        out.innerHTML = `النتيجة (ميلادي): ${base.format("YYYY-MM-DD")}`;
        return;
      }

      if(mode === "b2h"){
        const h = base.clone().add(-hijriOffset, "days");
        out.innerHTML =
          `النتيجة (هجري قمري): ${h.format("iYYYY/iM/iD")}<br>` +
          `<span class="small">ملاحظة: "بابلي شمسي" هنا = جلالي بالأرقام لكن بأسماء أشهر بابليّة.</span>`;
        return;
      }

      if(mode === "h2b"){
        const mJ = base.clone(); // بعد التصحيح
        out.innerHTML = `النتيجة (بابلي شمسي): ${formatBabylonFromMoment(mJ)}`;
        return;
      }
    }
  </script>
</body>
</html>
